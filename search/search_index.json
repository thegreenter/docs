{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"faq/","title":"Preguntas Frecuentes","text":""},{"location":"faq/#facturas","title":"Facturas","text":"<p>Que es el CDR</p> <p>CDR son las siglas de constancia de recepcion y es emitida por sunat indicando que una factura ha sido aceptada o rechazada. Para saber a cual estado pertenece la factura emitida, debemos identificar en que rango de la siguiente tabla se encuentra el codigo de respuesta.</p> Rango Descripci\u00f3n Que hacer 0100 a 1999 Excepciones Corregir y volver a enviar la factura 2000 a 3999 Errores (Rechazo) Emitir una nueva factura &gt;4000 Observaciones Corregir en futuras facturas"},{"location":"faq/#resumen-diario","title":"Resumen diario","text":"<p>Como obtener el CDR</p> <p>El proceso del resumen diario se compone de 2 fases, el env\u00edo y la obtenci\u00f3n del CDR; este \u00faltimo no siempre se puede obtener inmediatamente, para ello debemos tener en cuenta el c\u00f3digo que Sunat responde.</p> C\u00f3digo Descripci\u00f3n Estado del CDR 0 Procesado correctamente Disponible 98 En Proceso Volver a consultar 99 Procesado con errores Disponible <p>Enviar Boleta o Resumen diario</p> <p>Desde los inicios de facturaci\u00f3n electr\u00f3nica comunicar a SUNAT sobre las boletas de venta emitidas, debian realizarse por medio de un Resumen diario, actualmente ambas opciones son permitidas1, puedes seguir enviando los resumen diario o enviar boletas individualmente  como se hace con las facturas.</p>"},{"location":"faq/#webservice","title":"WebService","text":"<p>Bad Gateway</p> <p>Este es un error al conectarse con el servicio (Sunat u OSE), y lo unico que se puede hacer es informar al administrador del servicio y esperar.</p> <p>Could not connect to host</p> <p>Este mensaje puede ser resultado de varios casos, entre ellos falta de conectividad a internet, y otro mas recurrente por problemas al validar el certificado SSL del servicio a conectar. Para solucionar esto puede probar una de estas opciones:  - Instalar el certificado de sunat en el servidor que se esta usando  - En caso de sistemas linux, actualizar <code>ca-certificates</code>  - Deshabilitar la verificaci\u00f3n SSL en <code>Ws\\Services\\SoapClient.php</code> <pre><code>&lt;?php\n\n$parameters=[\n    'stream_context' =&gt; stream_context_create([\n        'ssl' =&gt; [\n            'verify_peer' =&gt; false,\n        ],\n    ]),\n];\n</code></pre></p> <ol> <li> <p>Resoluci\u00f3n N.\u00b0 114 -2019/SUNAT: Art. 12, En caso el emisor electr\u00f3nico opte por enviar a la SUNAT un ejemplar de la boleta de venta electr\u00f3nica y/o de las notas electr\u00f3nicas vinculadas, debe hacerlo hasta en un plazo m\u00e1ximo de cinco d\u00edas calendarios.\u00a0\u21a9</p> </li> </ol>"},{"location":"migrate2.1/","title":"Migrar a UBL 2.1","text":"<p>En el archivo <code>composer.json</code>, ajustar la version de <code>greenter/greenter</code> a la version <code>3.0</code>.</p> <pre><code>{\n\"require\": {\n\"greenter/greenter\": \"^3.0\"\n}\n}\n</code></pre> <p>Luego ejecutar <pre><code>composer update greenter/greenter\n</code></pre></p>"},{"location":"migrate2.1/#nuevos-campos","title":"Nuevos Campos","text":"<p>El principal cambio para indicar que el comprobante utilize UBL 2.1, es seteando el campo <code>ublVersion</code> que existe en <code>Invoice</code> y <code>Note</code>. <pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Note;\n\n$invoice = new Invoice();\n$invoice-&gt;setUblVersion('2.1');\n// ....\n\n$note = new Note();\n$note-&gt;setUblVersion('2.1');\n// ...\n</code></pre></p> <p>Ejemplo</p> <p>En el ejemplo de primeros pasos, ver\u00e1 los nuevos campos resaltados en el c\u00f3digo.</p>"},{"location":"production/","title":"Greenter en Producci\u00f3n","text":"<p>En esta secci\u00f3n de indican los pasos para convertirse en Emisor Electr\u00f3nico.</p>"},{"location":"production/#pasos","title":"Pasos","text":"<ul> <li>Creaci\u00f3n de usuario secundario con los permisos para Facturaci\u00f3n Electr\u00f3nica.</li> <li>Registrar el certificado digital en el portal de SUNAT, en formato <code>.cer</code> (Public key).</li> <li>Greenter requiere el certificado digital en formato <code>.pem</code> (Private &amp; Public Key), si tiene un certificado <code>.pfx</code>  puede convertirlo siguiendo esta gu\u00eda.</li> <li>Configurar la url del servicio de Producci\u00f3n (ver Lista de servicios).</li> </ul> <pre><code>&lt;?php\nuse Greenter\\Ws\\Services\\SunatEndpoints;\n\n$see = new \\Greenter\\See();\n$see-&gt;setService(SunatEndpoints::FE_PRODUCCION); // Cambiar la url para cuando sea Percepci\u00f3n/Retenci\u00f3n o Gu\u00eda de Remisi\u00f3n. \n$see-&gt;setCertificate(file_get_contents(__DIR__.'/valid-cer.pem'));\n$see-&gt;setClaveSOL('20000000001D', 'NOMBLOI', 'psdlbmrt');\n</code></pre> <p>Usuario Secundario</p> <p>Despues de crear el usuario secundario, tiene que esperar hasta un plazo de 24 horas para que este activo y pueda usarlo.</p>"},{"location":"starter/","title":"Empezando con Greenter","text":"<p>En este primero ejemplo, veremos el flujo b\u00e1sico del proceso de facturaci\u00f3n electr\u00f3nica, desde la elaboraci\u00f3n del comprobante electr\u00f3nico (archivo XML), la inclusi\u00f3n de la firma digital, y posterior envi\u00f3 a SUNAT, adem\u00e1s de la lectura del CDR1.</p> <p></p>"},{"location":"starter/#instalacion","title":"Instalaci\u00f3n","text":"<p>La forma mas f\u00e1cil de instalar grenter es utilizando composer. <pre><code>composer require greenter/lite\n</code></pre></p>"},{"location":"starter/#requerimientos","title":"Requerimientos","text":"T\u00e9cnico <ul> <li>PHP <code>7.2</code> o superior</li> <li>Certificado en formato PEM</li> <li>Credenciales Clave SOL</li> </ul> <p>Se necesita tener las siguientes extensiones habilitadas en <code>php.ini</code>.</p> <pre><code>extension=soap\nextension=openssl\n</code></pre> Bases <p>Para conocer m\u00e1s detalles sobre el proceso de Facturaci\u00f3n Electr\u00f3nica, puede consultar.</p> <ul> <li>FE Primer - Gu\u00eda de inicio hecho por Greenter</li> <li>cpe.sunat.gob.pe - P\u00e1gina oficial de SUNAT</li> </ul>"},{"location":"starter/#configuracion","title":"Configuraci\u00f3n","text":"<p>Para firmar nuestro comprobante electr\u00f3nico utilizaremos este certificado de prueba, y para conectarnos a los servicios <code>BETA</code> de SUNAT, usaremos las credenciales Clave SOL por defecto.</p> <ul> <li>RUC: <code>20000000001</code></li> <li>Usuario: <code>MODDATOS</code></li> <li>Contrase\u00f1a: <code>moddatos</code></li> </ul> <p>Crearemos el archivo <code>config.php</code> donde configuraremos el certificado digital, la ruta del servicio y las credenciales (Clave SOL) a utilizar: config.php<pre><code>&lt;?php\nuse Greenter\\Ws\\Services\\SunatEndpoints;\nuse Greenter\\See;\n\n$see = new See();\n$see-&gt;setCertificate(file_get_contents(__DIR__.'/certificate.pem'));\n$see-&gt;setService(SunatEndpoints::FE_BETA);\n$see-&gt;setClaveSOL('20000000001', 'MODDATOS', 'moddatos');\n\nreturn $see;\n</code></pre></p> Certificado .PFX - PKCS#12 <p>Si cuentas con un certificado <code>.p12</code> \u00f3 <code>.pfx</code>, puedes configurar el certificado con el siguiente c\u00f3digo:</p> <pre><code>&lt;?php\nuse Greenter\\XMLSecLibs\\Certificate\\X509Certificate;\nuse Greenter\\XMLSecLibs\\Certificate\\X509ContentType;\n\n// ...\n\n$pfx = file_get_contents('mycert.pfx');\n$password = 'YOUR-PASSWORD';\n\n$certificate = new X509Certificate($pfx, $password);\n\n$see-&gt;setCertificate($certificate-&gt;export(X509ContentType::PEM));\n\n// ...\n</code></pre>"},{"location":"starter/#definicion-del-comprobante","title":"Definici\u00f3n del comprobante","text":"<p>Para el ejemplo, el comprobante a utilizar ser\u00e1 una factura gravada, con la siguiente definici\u00f3n.</p> <pre><code>La empresa GREEN SAC, identificada con RUC 20123456789; desea emitir \nsu primera factura electr\u00f3nica N\u00b0 F001-1 con la siguiente informaci\u00f3n:\n</code></pre> Global Numero F001-1 Fecha de Emisi\u00f3n 21/07/2020 Hora de Emisi\u00f3n 13:05 Forma de Pago Contado Moneda Sol (PEN) RUC de Emisor 20123456789 RUC de Receptor 20000000001 Operaciones Gravadas S/ 100.00 Valor Venta S/ 100.00 IGV S/ 18.00 Total Impuestos S/ 18.00 Importe Total S/ 118.00 Detalle Codigo P001 Descripc\u00edon Tijeras Unidad de Medida Unidad (NIU) Cantidad 2 Valor unitario S/ 50.00 Valor venta S/ 100.00 Tipo de afectaci\u00f3n IGV Gravado (10) IGV S/ 18.00 Total Impuestos S/ 18.00 Precio unitario S/ 59.00"},{"location":"starter/#factura-electronica","title":"Factura Electr\u00f3nica","text":"<p>Crearemos nuestra primera factura electr\u00f3nica siguiendo el est\u00e1ndar UBL 2.1, en nuevo archivo <code>factura.php</code> agregaremos el siguiente c\u00f3digo: factura.php<pre><code>&lt;?php\n\nuse Greenter\\Model\\Client\\Client;\nuse Greenter\\Model\\Company\\Company;\nuse Greenter\\Model\\Company\\Address;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\SaleDetail;\nuse Greenter\\Model\\Sale\\Legend;\n\nrequire __DIR__.'/vendor/autoload.php';\n\n$see = require __DIR__.'/config.php';\n\n// Cliente\n$client = (new Client())\n    -&gt;setTipoDoc('6')\n    -&gt;setNumDoc('20000000001')\n    -&gt;setRznSocial('EMPRESA X');\n\n// Emisor\n$address = (new Address())\n    -&gt;setUbigueo('150101')\n    -&gt;setDepartamento('LIMA')\n    -&gt;setProvincia('LIMA')\n    -&gt;setDistrito('LIMA')\n    -&gt;setUrbanizacion('-')\n    -&gt;setDireccion('Av. Villa Nueva 221')\n    -&gt;setCodLocal('0000'); // Codigo de establecimiento asignado por SUNAT, 0000 por defecto.\n\n$company = (new Company())\n    -&gt;setRuc('20123456789')\n    -&gt;setRazonSocial('GREEN SAC')\n    -&gt;setNombreComercial('GREEN')\n    -&gt;setAddress($address);\n\n// Venta\n$invoice = (new Invoice())\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101') // Venta - Catalog. 51\n    -&gt;setTipoDoc('01') // Factura - Catalog. 01 \n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('1')\n    -&gt;setFechaEmision(new DateTime('2020-08-24 13:05:00-05:00')) // Zona horaria: Lima\n    -&gt;setFormaPago(new FormaPagoContado()) // FormaPago: Contado\n    -&gt;setTipoMoneda('PEN') // Sol - Catalog. 02\n    -&gt;setCompany($company)\n    -&gt;setClient($client)\n    -&gt;setMtoOperGravadas(100.00)\n    -&gt;setMtoIGV(18.00)\n    -&gt;setTotalImpuestos(18.00)\n    -&gt;setValorVenta(100.00)\n    -&gt;setSubTotal(118.00)\n    -&gt;setMtoImpVenta(118.00)\n    ;\n\n$item = (new SaleDetail())\n    -&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU') // Unidad - Catalog. 03\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(50.00)\n    -&gt;setDescripcion('PRODUCTO 1')\n    -&gt;setMtoBaseIgv(100)\n    -&gt;setPorcentajeIgv(18.00) // 18%\n    -&gt;setIgv(18.00)\n    -&gt;setTipAfeIgv('10') // Gravado Op. Onerosa - Catalog. 07\n    -&gt;setTotalImpuestos(18.00) // Suma de impuestos en el detalle\n    -&gt;setMtoValorVenta(100.00)\n    -&gt;setMtoPrecioUnitario(59.00)\n    ;\n\n$legend = (new Legend())\n    -&gt;setCode('1000') // Monto en letras - Catalog. 52\n    -&gt;setValue('SON DOSCIENTOS TREINTA Y SEIS CON 00/100 SOLES');\n\n$invoice-&gt;setDetails([$item])\n        -&gt;setLegends([$legend]);\n</code></pre></p> <p>Los cat\u00e1logos que se mencionan en los comentarios del c\u00f3digo se encuentran en la Reglas de Validaciones de SUNAT, puedes obtener la \u00faltima versi\u00f3n en la p\u00e1gina oficial de SUNAT.</p>"},{"location":"starter/#envio-a-sunat","title":"Env\u00edo a SUNAT","text":"<p>En el mismo archivo <code>factura.php</code> agregaremos el c\u00f3digo de abajo, el m\u00e9todo <code>send</code> envuelve varios procesos en si, primero genera el XML, lo firma digitalmente, lo env\u00eda al servici\u00f3 de SUNAT y procesa la respuesta (CDR).</p> <p><pre><code>&lt;?php\n\n$result = $see-&gt;send($invoice);\n\n// Guardar XML firmado digitalmente.\nfile_put_contents($invoice-&gt;getName().'.xml',\n                  $see-&gt;getFactory()-&gt;getLastXml());\n\n// Verificamos que la conexi\u00f3n con SUNAT fue exitosa.\nif (!$result-&gt;isSuccess()) {\n    // Mostrar error al conectarse a SUNAT.\n    echo 'Codigo Error: '.$result-&gt;getError()-&gt;getCode();\n    echo 'Mensaje Error: '.$result-&gt;getError()-&gt;getMessage();\n    exit();\n}\n\n// Guardamos el CDR\nfile_put_contents('R-'.$invoice-&gt;getName().'.zip', $result-&gt;getCdrZip());\n</code></pre> Para saber como actuar seg\u00fan el c\u00f3digo de error que SUNAT devuelve, es muy importante revisar las Reglas de Validaci\u00f3n, all\u00ed encontraremos todas las validaciones que SUNAT aplica a los diferentes comprobantes electr\u00f3nicos disponibles, adem\u00e1s de lista de cat\u00e1logos y la lista completa de codigos de error.</p>"},{"location":"starter/#lectura-del-cdr","title":"Lectura del CDR","text":"<p>Finalmente para saber si nuestro comprobante fue procesado correctamente y ha sido aceptado por SUNAT, necesitamos leer la informac\u00edon contenida en el CDR1.</p> <pre><code>&lt;?php\n/*\n* file: factura.php \n*/\n\n$cdr = $result-&gt;getCdrResponse();\n\n$code = (int)$cdr-&gt;getCode();\n\nif ($code === 0) {\n    echo 'ESTADO: ACEPTADA'.PHP_EOL;\n    if (count($cdr-&gt;getNotes()) &gt; 0) {\n        echo 'OBSERVACIONES:'.PHP_EOL;\n        // Corregir estas observaciones en siguientes emisiones.\n        var_dump($cdr-&gt;getNotes());\n    }  \n} else if ($code &gt;= 2000 &amp;&amp; $code &lt;= 3999) {\n    echo 'ESTADO: RECHAZADA'.PHP_EOL;\n} else {\n    /* Esto no deber\u00eda darse, pero si ocurre, es un CDR inv\u00e1lido que deber\u00eda tratarse como un error-excepci\u00f3n. */\n    /*code: 0100 a 1999 */\n    echo 'Excepci\u00f3n';\n}\n\necho $cdr-&gt;getDescription().PHP_EOL;\n</code></pre> <p>M\u00e1s detalles sobre que hacer si una factura fue observada o rechazada, aqu\u00ed. </p>"},{"location":"starter/#ejecutar","title":"Ejecutar","text":"<p>Finalmente ejecutaremos el script desde la linea de comandos. <pre><code>php factura.php\n</code></pre> y si todo sale bien obtendremos como respuesta.  </p> <p>Exito!</p> <p>ESTADO: ACEPTADA    La Factura numero F001-1, ha sido aceptada</p> <p>Estructura finald del proyecto de ejemplo:</p> <pre><code>/\n\u251c\u2500\u2500 vendor/\n\u251c\u2500\u2500 certificate.pem\n\u251c\u2500\u2500 composer.json\n\u251c\u2500\u2500 config.php\n\u251c\u2500\u2500 factura.php\n\u251c\u2500\u2500 20123456789-01-F001-1.xml\n\u251c\u2500\u2500 R-20123456789-01-F001-1.zip\n</code></pre> <p>Este ejemplo puedes encontrarlo en @thegreenter/firststeps.</p>"},{"location":"starter/#que-sigue","title":"\u00bfQue sigue?","text":"<ul> <li>Detalles de uso de greenter</li> <li>Ejemplos de comprobantes electr\u00f3nicos</li> <li>Revisar los paquetes que componen greenter</li> </ul>"},{"location":"starter/#comentarios","title":"Comentarios","text":"<p>Pueden unirse a \ud83d\udc4b Greenter Community.</p> <ol> <li> <p>Comprobante de Recepci\u00f3n (CDR), es un archivo xml que contiene la respuesta de SUNAT, al env\u00edo previo de un comprobante electr\u00f3nico, en ella se indica si un comprobante ha sido aceptado, aceptado con observaciones o rechazado.\u00a0\u21a9\u21a9</p> </li> </ol>"},{"location":"usage/","title":"Uso de Greenter","text":"<p>M\u00e1s opciones que tenemos al utilizar Greenter.</p>"},{"location":"usage/#generar-xml-firmado","title":"Generar XML firmado","text":"<p>El ejemplo b\u00e1sico nos mostr\u00f3 como realizar todo el proceso de facturacion con un solo m\u00e9todo <code>send()</code>, pero si necesitamos generar solo el XML firmado, lo cual seria \u00fatil para Boletas de Venta ya que estas no se env\u00edan a SUNAT individualmente.</p> <pre><code>&lt;?php\n\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\See;\n\n$boleta = (new Invoice())\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('03') // C\u00f3digo para Boletas, ver Catalog. 51  \n    -&gt;setSerie('B001')\n    -&gt;setCorrelativo('1')\n    // ...\n    ;\n\n$see = new See();\n$see-&gt;setCertificate(file_get_contents(__DIR__.'/certificate.pem'));\n\n$xml = $see-&gt;getXmlSigned($boleta);\n\nfile_put_contents('20000000001-03-B001-1.xml', $xml);\n</code></pre>"},{"location":"usage/#enviar-xml-generado","title":"Enviar XML generado","text":"<p>Si necesitas enviar un XML previamente generado, debes seguir el siguiente ejemplo.</p> <pre><code>&lt;?php\n\nrequire __DIR__.'/vendor/autoload.php';\n\n$see = require __DIR__.'/config.php';\n\n$xmlSigned = file_get_contents('20000000001-01-F001-1.xml');\n\n$result = $see-&gt;sendXmlFile($xmlSigned);\n// $result se maneja del mismo modo que con el metodo send()\n</code></pre>"},{"location":"usage/#resumen-diario","title":"Resumen diario","text":"<p>Para comunicar las boletas de ventas emitidas o anuladas, as\u00ed como las notas de cr\u00e9dito/d\u00e9bito releacionadas, necesita hacerlo mediante un resumen diario. A diferencia del env\u00edo de una factura, donde la respuesta es inmediata, en este documento debemos hacer un consulta adicional para conocer su estado utilizando el numero de ticket.</p> <pre><code>&lt;?php\n\nuse Greenter\\Model\\Company\\Company;\nuse Greenter\\Model\\Company\\Address;\nuse Greenter\\Model\\Sale\\Document;\nuse Greenter\\Model\\Summary\\Summary;\nuse Greenter\\Model\\Summary\\SummaryDetail;\n\n$company = new Company();\n$company-&gt;setRuc('20000000001')\n    -&gt;setRazonSocial('EMPRESA SAC')\n    -&gt;setNombreComercial('EMPRESA')\n    -&gt;setAddress((new Address())\n        -&gt;setUbigueo('150101')\n        -&gt;setDepartamento('LIMA')\n        -&gt;setProvincia('LIMA')\n        -&gt;setDistrito('LIMA')\n        -&gt;setUrbanizacion('Albar')\n        -&gt;setDireccion('AV ROSALES'));\n\n$detail = new SummaryDetail();\n$detail-&gt;setTipoDoc('07') // Nota de Credito\n    -&gt;setSerieNro('B001-4')\n    -&gt;setDocReferencia((new Document()) // Documento relacionado (Boleta)\n        -&gt;setTipoDoc('03')\n        -&gt;setNroDoc('B001-1'))\n    -&gt;setEstado('1') // Emisi\u00f3n\n    -&gt;setClienteTipo('1') // Tipo documento identidad: DNI\n    -&gt;setClienteNro('00000000') // Nro de documento identidad\n    -&gt;setTotal(200)\n    -&gt;setMtoOperGravadas(40)\n    -&gt;setMtoOperExoneradas(50)\n    -&gt;setMtoOperInafectas(100)\n    -&gt;setMtoIGV(7.2)\n    -&gt;setMtoISC(2.8);\n\n$detail2 = new SummaryDetail();\n$detail2-&gt;setTipoDoc('03') // Boleta\n    -&gt;setSerieNro('B001-2')\n    -&gt;setEstado('3') // Anulaci\u00f3n\n    -&gt;setClienteTipo('1')\n    -&gt;setClienteNro('00000000')\n    -&gt;setTotal(119)\n    -&gt;setMtoOperGravadas(20)\n    -&gt;setMtoOperInafectas(24.4)\n    -&gt;setMtoOperExoneradas(50)\n    -&gt;setMtoOtrosCargos(21)\n    -&gt;setMtoIGV(3.6);\n\n$resumen = new Summary();\n$resumen-&gt;setFecGeneracion(new \\DateTime('2020-08-01')) // Fecha de emisi\u00f3n de las boletas.\n    -&gt;setFecResumen(new \\DateTime('2020-08-02')) // Fecha de env\u00edo del resumen diario.\n    -&gt;setCorrelativo('001') // Correlativo, necesario para diferenciar de otros Resumen diario del mismo d\u00eda.\n    -&gt;setCompany($company)\n    -&gt;setDetails([$detail, $detail2]);\n\n$result = $see-&gt;send($resumen);\n// Guardar XML\nfile_put_contents($resumen-&gt;getName().'.xml',\n                  $see-&gt;getFactory()-&gt;getLastXml());\n\nif (!$result-&gt;isSuccess()) {\n    // Si hubo error al conectarse al servicio de SUNAT.\n    var_dump($result-&gt;getError());\n    exit();\n}\n\n$ticket = $result-&gt;getTicket();\necho 'Ticket : '.$ticket.PHP_EOL;\n\n$statusResult = $see-&gt;getStatus($ticket);\nif (!$statusResult-&gt;isSuccess()) {\n    // Si hubo error al conectarse al servicio de SUNAT.\n    var_dump($statusResult-&gt;getError());\n    return;\n}\n\necho $statusResult-&gt;getCdrResponse()-&gt;getDescription();\n// Guardar CDR\nfile_put_contents('R-'.$resumen-&gt;getName().'.zip', $statusResult-&gt;getCdrZip());\n</code></pre>"},{"location":"usage/#comunicacion-de-baja","title":"Comunicacion de Baja","text":"<p>Para comunicar a SUNAT las anulaciones de facturas y sus notas de cr\u00e9dito/d\u00e9bito releacionadas, necesita hacerlo mediante el documento de comunicaci\u00f3n de baja.   </p> <p>El env\u00edo a los servicios de SUNAT se maneja de la misma forma que el resumen diario.</p> <pre><code>&lt;?php\n\nuse Greenter\\Model\\Voided\\Voided;\nuse Greenter\\Model\\Voided\\VoidedDetail;\n\n$detail1 = new VoidedDetail();\n$detail1-&gt;setTipoDoc('01') // Factura\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('1')\n    -&gt;setDesMotivoBaja('ERROR EN C\u00c1LCULOS'); // Motivo por el cual se da de baja.\n\n$detail2 = new VoidedDetail();\n$detail2-&gt;setTipoDoc('07') // Nota de Cr\u00e9dito\n    -&gt;setSerie('FC01')\n    -&gt;setCorrelativo('2')\n    -&gt;setDesMotivoBaja('ERROR DE RUC');\n\n$cDeBaja = new Voided();\n$cDeBaja-&gt;setCorrelativo('00001') // Correlativo, necesario para diferenciar c. de baja de en un mismo d\u00eda.\n    -&gt;setFecGeneracion(new \\DateTime('2020-08-01')) // Fecha de emisi\u00f3n de los comprobantes a dar de baja\n    -&gt;setFecComunicacion(new \\DateTime('2020-08-02')) // Fecha de envio de la C. de baja\n    -&gt;setCompany($company)\n    -&gt;setDetails([$detail1, $detail2]);\n\n$result = $see-&gt;send($cDeBaja);\n// Guardar XML\nfile_put_contents($cDeBaja-&gt;getName().'.xml',\n                  $see-&gt;getFactory()-&gt;getLastXml());\n\nif (!$result-&gt;isSuccess()) {\n    // Si hubo error al conectarse al servicio de SUNAT.\n    var_dump($result-&gt;getError());\n    exit();\n}\n\n$ticket = $result-&gt;getTicket();\necho 'Ticket : '.$ticket.PHP_EOL;\n\n$statusResult = $see-&gt;getStatus($ticket);\nif (!$statusResult-&gt;isSuccess()) {\n    // Si hubo error al conectarse al servicio de SUNAT.\n    var_dump($statusResult-&gt;getError());\n    return;\n}\n\necho $statusResult-&gt;getCdrResponse()-&gt;getDescription();\n// Guardar CDR\nfile_put_contents('R-'.$cDeBaja-&gt;getName().'.zip', $statusResult-&gt;getCdrZip());\n</code></pre> <p>Anulaci\u00f3n de Boletas</p> <p>Para anular boletas y NCR, NDB relacionadas, se utiliza el resumen diario indicando  el campo <code>estado=3</code></p>"},{"location":"examples/anticipo/","title":"Factura con Deducci\u00f3n de Anticipos","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/anticipo/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\Prepayment;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n    -&gt;setMtoOperGravadas(200)\n    -&gt;setMtoIGV(36)\n    -&gt;setValorVenta(200)\n    -&gt;setTotalImpuestos(36)\n    -&gt;setSubTotal(236)\n    -&gt;setMtoImpVenta(136) // Disminuci\u00f3n por anticipo\n-&gt;setAnticipos([\n(new Prepayment())\n-&gt;setTipoDocRel('02') // catalog. 12\n-&gt;setNroDocRel('F001-111')\n-&gt;setTotal(100)\n])\n-&gt;setTotalAnticipos(100);\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(100)\n    -&gt;setMtoValorVenta(200)\n    -&gt;setMtoBaseIgv(200)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(36)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setTotalImpuestos(36)\n    -&gt;setMtoPrecioUnitario(118)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON CIENTO DIECIOCHO CON OO/100 SOLES')\n    ]);\n</code></pre>"},{"location":"examples/boleta/","title":"Boleta de Venta","text":"<p>Este ejemplo muestra la creaci\u00f3n del XML para una boleta de venta electr\u00f3nica, empleando el est\u00e1ndar UBL 2.1</p>"},{"location":"examples/boleta/#ejemplo","title":"Ejemplo","text":"<pre><code>&lt;?php\n\nuse Greenter\\Model\\Client\\Client;\nuse Greenter\\Model\\Company\\Company;\nuse Greenter\\Model\\Company\\Address;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\SaleDetail;\nuse Greenter\\Model\\Sale\\Legend;\n\nrequire __DIR__.'/vendor/autoload.php';\n\n$see = require __DIR__.'/config.php';\n\n// Cliente\n$client = new Client();\n$client-&gt;setTipoDoc('1')\n    -&gt;setNumDoc('46712369')\n    -&gt;setRznSocial('MARIA RAMOS ARTEAGA');\n\n// Emisor\n$address = new Address();\n$address-&gt;setUbigueo('150101')\n    -&gt;setDepartamento('LIMA')\n    -&gt;setProvincia('LIMA')\n    -&gt;setDistrito('LIMA')\n    -&gt;setUrbanizacion('-')\n    -&gt;setDireccion('AV LOS GERUNDIOS');\n\n$company = new Company();\n$company-&gt;setRuc('20000000001')\n    -&gt;setRazonSocial('EMPRESA SAC')\n    -&gt;setNombreComercial('EMPRESA')\n    -&gt;setAddress($address);\n\n// Venta\n$invoice = (new Invoice())\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101') // Catalog. 51\n    -&gt;setTipoDoc('03')\n    -&gt;setSerie('B001')\n    -&gt;setCorrelativo('1')\n    -&gt;setFechaEmision(new DateTime())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($client)\n    -&gt;setMtoOperGravadas(100.00)\n    -&gt;setMtoIGV(18.00)\n    -&gt;setTotalImpuestos(18.00)\n    -&gt;setValorVenta(100.00)\n    -&gt;setSubTotal(118.00)\n    -&gt;setMtoImpVenta(118.00)\n    -&gt;setCompany($company);\n\n$item = (new SaleDetail())\n    -&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setCantidad(2)\n    -&gt;setDescripcion('PRODUCTO 1')\n    -&gt;setMtoBaseIgv(100)\n    -&gt;setPorcentajeIgv(18.00) // 18%\n    -&gt;setIgv(18.00)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setTotalImpuestos(18.00)\n    -&gt;setMtoValorVenta(100.00)\n    -&gt;setMtoValorUnitario(50.00)\n    -&gt;setMtoPrecioUnitario(59.00);\n\n$legend = (new Legend())\n    -&gt;setCode('1000')\n    -&gt;setValue('SON CIENTO DIECIOCHO CON 00/100 SOLES');\n\n$invoice-&gt;setDetails([$item])\n        -&gt;setLegends([$legend]);\n\n$xml = $see-&gt;getXmlSigned($invoice);\n\n// Guardar XML\nfile_put_contents($invoice-&gt;getName().'.xml', $xml);\n</code></pre>"},{"location":"examples/contingencia/","title":"Contingencia","text":"<p>Existen situaciones adversas por la que un emisor electr\u00f3nico no puede emitir comprobantes electronicos, en ese caso  SUNAT les da la posibilidad de emitir un comprobante fisico, como anteriormente se realizaba.</p> <p>Para informar a SUNAT de estos comprobantes, a partir del 01-09-2018 se envi\u00e1 de la misma forma como se hace con los comprobantes electr\u00f3nicos.</p> <p>Las boletas por contingencia se pueden seguir enviando mediante el resumen diario de boletas.</p>"},{"location":"examples/contingencia/#representacion-impresa","title":"Representaci\u00f3n Impresa","text":"<p>La representaci\u00f3n impresa de los comprobantes de contingencia deben incluir algunas leyendas, el primero: \"Emisor electr\u00f3nico obligado\" y otra dependiendo del tipo de comprobante</p> Tipo documento Leyenda Factura y Boleta \"Comprobante de Pago emitido en contingencia\" Nota de Cr\u00e9dito \"Nota de Cr\u00e9dito emitida en contingencia\" Nota de D\u00e9bito \"Nota de D\u00e9dito emitida en contingencia\" C. de Retenci\u00f3n \"Comprobante de Retenci\u00f3n emitido en contingencia\" C. de Percepci\u00f3n \"Comprobante de Percepci\u00f3n emitido en contingencia\""},{"location":"examples/contingencia/#factura-electronica","title":"Factura Electr\u00f3nica","text":"<p>El cambio con respecto a la emision normal de un comprobante electr\u00f3nico es la serie, que es num\u00e9rica.</p> <pre><code>&lt;?php\n//...\n\n$invoice-&gt;setSerie('0001');\n\n//...\n</code></pre>"},{"location":"examples/contingencia/#referencia","title":"Referencia","text":"<p>Procedimiento de contingencia - SUNAT</p>"},{"location":"examples/descuento-linea/","title":"Factura con Descuentos","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/descuento-linea/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Charge;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice-&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n    -&gt;setMtoOperGravadas(180)\n    -&gt;setMtoIGV(32.40)\n    -&gt;setTotalImpuestos(32.40)\n    -&gt;setValorVenta(180)\n    -&gt;setSubTotal(212.40)\n    -&gt;setMtoImpVenta(212.40);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(100)\n-&gt;setDescuentos([\n(new Charge())\n-&gt;setCodTipo('00') // Catalog. 53\n-&gt;setMontoBase(200)\n-&gt;setFactor(0.10)\n-&gt;setMonto(20)\n])\n-&gt;setMtoValorVenta(180)\n    -&gt;setMtoBaseIgv(180)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(32.40)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setTotalImpuestos(32.40)\n    -&gt;setMtoPrecioUnitario(106.3)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON DOSCIENTOS DOCE CON 40/100 SOLES')\n    ]);\n</code></pre>"},{"location":"examples/detraccion/","title":"Factura con Detracciones","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/detraccion/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Detraction;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice\n    -&gt;setUblVersion('2.1')\n-&gt;setTipoOperacion('1001') // Catalogo 51: Detracci\u00f3n\n-&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('127')\n    -&gt;setFechaEmision(new DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n    -&gt;setMtoOperGravadas(800)\n    -&gt;setMtoIGV(144)\n    -&gt;setTotalImpuestos(144)\n    -&gt;setValorVenta(800)\n    -&gt;setSubTotal(944)\n    -&gt;setMtoImpVenta(944)\n    -&gt;setDetraccion(\n    // MONEDA SIEMPRE EN SOLES\n(new Detraction())\n// Carnes y despojos comestibles\n-&gt;setCodBienDetraccion('014') // catalog. 54\n// Deposito en cuenta\n-&gt;setCodMedioPago('001') // catalog. 59\n-&gt;setCtaBanco('0004-3342343243')\n-&gt;setPercent(4.00)\n-&gt;setMount(37.76)\n);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('ZZ')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(4)\n    -&gt;setMtoValorUnitario(200)\n    -&gt;setMtoValorVenta(800)\n    -&gt;setMtoBaseIgv(800)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(144)\n    -&gt;setTipAfeIgv('10') // Catalogo 07 - Gravado\n    -&gt;setTotalImpuestos(144)\n    -&gt;setMtoPrecioUnitario(236)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON NOVECIENTOS CUARENTA Y CUATRO CON OO/100 SOLES'),\n        (new Legend())\n-&gt;setCode('2006')\n-&gt;setValue('Operaci\u00f3n sujeta a detracci\u00f3n')\n]);\n</code></pre>"},{"location":"examples/exonerada/","title":"Factura Exonerada","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/exonerada/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice-&gt;setFecVencimiento(new \\DateTime())\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n-&gt;setMtoOperExoneradas(200)\n-&gt;setMtoIGV(0)\n    -&gt;setTotalImpuestos(0)\n    -&gt;setValorVenta(200)\n    -&gt;setSubTotal(200)\n    -&gt;setMtoImpVenta(200);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(100)\n    -&gt;setMtoValorVenta(200)\n    -&gt;setMtoBaseIgv(200)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(0)\n-&gt;setTipAfeIgv('20')\n-&gt;setTotalImpuestos(0)\n    -&gt;setMtoPrecioUnitario(100)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON DOSCIENTOS CON OO/100 SOLES')\n    ]);\n</code></pre>"},{"location":"examples/exportacion/","title":"Factura Exportaci\u00f3n","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/exportacion/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\n\nuse Greenter\\Model\\Client\\Client;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice\n    -&gt;setUblVersion('2.1')\n-&gt;setTipoOperacion('0200') // Tipo Operacion: exportaction\n-&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('USD')\n    -&gt;setCompany($this-&gt;getCompany())\n-&gt;setClient((new Client()) // Cliente: extranjeria o sin documentos\n-&gt;setTipoDoc('0')\n-&gt;setNumDoc('-')\n-&gt;setRznSocial('EXTRANJERO')\n)\n-&gt;setMtoOperExportacion(100)\n-&gt;setMtoIGV(0)\n    -&gt;setTotalImpuestos(0)\n    -&gt;setValorVenta(100)\n    -&gt;setSubTotal(100)\n    -&gt;setMtoImpVenta(100);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n-&gt;setCodProdSunat('43231513') // Codigo Producto Sunat, requerido.\n-&gt;setUnidad('KG')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(50)\n    -&gt;setMtoValorVenta(100)\n    -&gt;setMtoBaseIgv(100)\n    -&gt;setPorcentajeIgv(0)\n    -&gt;setIgv(0)\n-&gt;setTipAfeIgv('40')\n-&gt;setTotalImpuestos(0)\n    -&gt;setMtoPrecioUnitario(50)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON CIEN CON OO/100 SOLES')\n    ]);\n</code></pre>"},{"location":"examples/forma-pago/","title":"Forma de Pago","text":"<p>A partir del 4 de Abril de 20211 ser\u00e1 obligatorio la inclusi\u00f3n de la forma de pago en el comprobante electr\u00f3nico.</p> <p>Los siguientes ejemplos muestran como incluir los tipos de forma de pago aceptados por SUNAT.</p>"},{"location":"examples/forma-pago/#contado","title":"Contado","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\n\n$invoice = new Invoice();\n$invoice-&gt;setFormaPago(new FormaPagoContado());\n</code></pre>"},{"location":"examples/forma-pago/#credito","title":"Credito","text":"Detalle Monto a pagar 100 Cuota 1 40 Fecha Pago 1 2020-02-10 Cuota 2 60 Fecha Pago 2 2020-02-17 <p>Ejemplo en Factura</p> <pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Cuota;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoCredito;\nuse Greenter\\Model\\Sale\\Invoice;\n\n$invoice = new Invoice();\n$invoice-&gt;setFormaPago(new FormaPagoCredito(100.00));\n$invoice-&gt;setCuotas([\n    (new Cuota())\n        -&gt;setMonto(40.00)\n        -&gt;setFechaPago(new DateTime('2020-02-10 00:00:00-05:00')),\n    (new Cuota())\n        -&gt;setMonto(60.00)\n        -&gt;setFechaPago(new DateTime('2020-02-17 00:00:00-05:00'))\n]);\n</code></pre> <p>Ejemplo en Nota de Cr\u00e9dito</p> <pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Cuota;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoCredito;\nuse Greenter\\Model\\Sale\\Note;\n\n$ncr = new Note();\n$ncr-&gt;setTipoDoc('07');\n$ncr-&gt;setFormaPago(new FormaPagoCredito(100.00));\n$ncr-&gt;setCuotas([\n    (new Cuota())\n        -&gt;setMonto(40.00)\n        -&gt;setFechaPago(new DateTime('2020-02-10 00:00:00-05:00')),\n    (new Cuota())\n        -&gt;setMonto(60.00)\n        -&gt;setFechaPago(new DateTime('2020-02-17 00:00:00-05:00'))\n]);\n</code></pre>"},{"location":"examples/forma-pago/#cambiar-de-moneda","title":"Cambiar de moneda","text":"<p>Por defecto la moneda es la definida en el comprobante, pero puede ser cambiada si es necesario.</p> <pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\Cuota;\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoCredito;\nuse Greenter\\Model\\Sale\\Invoice;\n\n$invoice = new Invoice();\n$invoice-&gt;setTipoMoneda('USD');\n$invoice-&gt;setFormaPago(new FormaPagoCredito(100.00, 'PEN'));\n$invoice-&gt;setCuotas([\n    (new Cuota())\n        -&gt;setMonto(40.00)\n        -&gt;setMoneda('PEN')\n        -&gt;setFechaPago(new DateTime('2020-02-10 00:00:00-05:00')),\n    (new Cuota())\n        -&gt;setMonto(60.00)\n        -&gt;setMoneda('PEN')\n        -&gt;setFechaPago(new DateTime('2020-02-17 00:00:00-05:00'))\n]);\n</code></pre> <ol> <li> <p>Resoluci\u00f3n N\u00ba 000193-2020/SUNAT - MODIFICAN LA NORMATIVA SOBRE EMISI\u00d3N ELECTR\u00d3NICA EN RELACI\u00d3N CON LA FACTURA ELECTR\u00d3NICA, EL RECIBO POR HONORARIOS ELECTR\u00d3NICO Y LA NOTA DE CR\u00c9DITO ELECTR\u00d3NICA\u00a0\u21a9</p> </li> </ol>"},{"location":"examples/gratuita/","title":"Factura Gratuita","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/gratuita/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n-&gt;setMtoOperGratuitas(200)\n-&gt;setMtoIGVGratuitas(36)\n-&gt;setTotalImpuestos(0)\n    -&gt;setValorVenta(0)\n    -&gt;setSubTotal(0)\n    -&gt;setMtoImpVenta(0);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(0)\n-&gt;setMtoValorGratuito(100)\n-&gt;setMtoValorVenta(200)\n    -&gt;setMtoBaseIgv(200)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(36)\n-&gt;setTipAfeIgv('11')\n-&gt;setTotalImpuestos(36)\n    -&gt;setMtoPrecioUnitario(0)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n-&gt;setCode('1002')\n-&gt;setValue('TRANSFERENCIA GRATUITA DE UN BIEN Y/O SERVICIO PRESTADO GRATUITAMENTE')\n]);\n</code></pre>"},{"location":"examples/icbper/","title":"Factura con ICBPER","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/icbper/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\n\n$invoice = new Invoice();\n$invoice\n    -&gt;setUblVersion('2.1')\n    -&gt;setTipoOperacion('0101')\n    -&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('129')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n    -&gt;setMtoOperGravadas(200.20)\n    -&gt;setMtoIGV(36.04)\n-&gt;setIcbper(0.80)\n-&gt;setTotalImpuestos(36.84)\n    -&gt;setValorVenta(200.20)\n    -&gt;setSubTotal(237.04)\n    -&gt;setRedondeo(0.04)\n    -&gt;setMtoImpVenta(237);\n\n$detail = new SaleDetail();\n$detail\n    -&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setCantidad(2)\n    -&gt;setDescripcion('PRODUCTO 1')\n    -&gt;setMtoBaseIgv(200.00)\n    -&gt;setPorcentajeIgv(18.0)\n    -&gt;setIgv(36)\n    -&gt;setTotalImpuestos(36)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setMtoValorVenta(200)\n    -&gt;setMtoValorUnitario(100)\n    -&gt;setMtoPrecioUnitario(118);\n\n$detailBolsa = new SaleDetail();\n$detailBolsa\n    -&gt;setCodProducto('P002')\n    -&gt;setUnidad('NIU')\n    -&gt;setCantidad(4)\n    -&gt;setDescripcion('BOLSA DE PLASTICO')\n    -&gt;setMtoValorUnitario(0.05)\n    -&gt;setMtoPrecioUnitario(0.059)\n    -&gt;setMtoValorVenta(0.20)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setMtoBaseIgv(0.20)\n    -&gt;setPorcentajeIgv(18.0)\n    -&gt;setIgv(0.04)\n-&gt;setIcbper(0.80) // (cantidad)*(factor ICBPER)\n-&gt;setFactorIcbper(0.20)\n-&gt;setTotalImpuestos(0.84)\n;\n\n$invoice-&gt;setDetails([$detail, $bolsa])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON DOSCIENTOS TREINTA Y SIETE CON 00/100 SOLES')\n    ]);\n</code></pre>"},{"location":"examples/icbper/#factor-icbper","title":"Factor ICBPER","text":"<p>La cuant\u00eda del impuesto al consumo de las bolsas de pl\u00e1stico es gradual y se aplica por la adquisici\u00f3n unitaria de bolsas de pl\u00e1stico, de acuerdo con el siguiente cronograma: </p> Monto A\u00f1o S/ 0.10 2019 S/ 0.20 2020 S/ 0.30 2021 S/ 0.40 2022 S/ 0.50 2023+"},{"location":"examples/mas/","title":"Otros Ejemplos","text":"<p>Puedes encontrar m\u00e1s ejemplos y que podr\u00e1s probar en vivo en @thegreenter/demo.</p>"},{"location":"examples/percepcion/","title":"Factura con Percepci\u00f3n","text":"<p>Las lineas resaltadas son propias de este modelo de factura.</p>"},{"location":"examples/percepcion/#codigo","title":"C\u00f3digo","text":"<pre><code>&lt;?php\nuse Greenter\\Model\\Sale\\FormaPagos\\FormaPagoContado;\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Model\\Sale\\Legend;\nuse Greenter\\Model\\Sale\\SaleDetail;\nuse Greenter\\Model\\Sale\\SalePerception;\n\n$invoice = new Invoice();\n$invoice-&gt;setUblVersion('2.1')\n-&gt;setTipoOperacion('2001') // Percepciones\n-&gt;setTipoDoc('01')\n    -&gt;setSerie('F001')\n    -&gt;setCorrelativo('123')\n    -&gt;setFechaEmision(new \\DateTime())\n    -&gt;setFormaPago(new FormaPagoContado())\n    -&gt;setTipoMoneda('PEN')\n    -&gt;setClient($this-&gt;getClient())\n    -&gt;setCompany($this-&gt;getCompany())\n    -&gt;setMtoOperGravadas(200)\n    -&gt;setMtoIGV(36)\n    -&gt;setTotalImpuestos(36)\n    -&gt;setValorVenta(200)\n    -&gt;setSubTotal(236)\n    -&gt;setMtoImpVenta(236)\n-&gt;setPerception((new SalePerception())\n-&gt;setCodReg('51')\n-&gt;setPorcentaje(0.02)\n-&gt;setMtoBase(200)\n-&gt;setMto(4.00)\n-&gt;setMtoTotal(204.00)\n)\n-&gt;setSumOtrosCargos(4.00);\n\n$detail = new SaleDetail();\n$detail-&gt;setCodProducto('P001')\n    -&gt;setUnidad('NIU')\n    -&gt;setDescripcion('PROD 1')\n    -&gt;setCantidad(2)\n    -&gt;setMtoValorUnitario(100)\n    -&gt;setMtoValorVenta(200)\n    -&gt;setMtoBaseIgv(200)\n    -&gt;setPorcentajeIgv(18)\n    -&gt;setIgv(36)\n    -&gt;setTipAfeIgv('10')\n    -&gt;setTotalImpuestos(36)\n    -&gt;setMtoPrecioUnitario(118)\n;\n\n$invoice-&gt;setDetails([$detail])\n    -&gt;setLegends([\n        (new Legend())\n            -&gt;setCode('1000')\n            -&gt;setValue('SON DOSCIENTOS TREINTA Y SEIS CON OO/100 SOLES'),\n        (new Legend())\n-&gt;setCode('2000')\n-&gt;setValue('COMPROBANTE DE PERCEPCI\u00d3N')\n]);\n</code></pre>"},{"location":"packages/report/","title":"Greenter Report","text":"<p>Para elaborar una representaci\u00f3n impresa se dispone de los formatos: HTML y PDF.</p>"},{"location":"packages/report/#instalar","title":"Instalar","text":"<pre><code>composer require greenter/report\n</code></pre>"},{"location":"packages/report/#documentos","title":"Documentos","text":"<p>Lista de documentos con reporte disponible.</p> <ul> <li>Factura  </li> <li>Boleta de Venta</li> <li>Nota de Cr\u00e9dito  </li> <li>Nota de D\u00e9bito  </li> <li>Gu\u00eda de Remisi\u00f3n  </li> <li>Comprobante de Retenci\u00f3n  </li> <li>Comprobante de Percepci\u00f3n</li> <li>Resumen diario de Boletas</li> <li>Comunicaci\u00f3n de Bajas</li> <li>Resumen diario de Reversiones</li> </ul>"},{"location":"packages/report/#uso","title":"Uso","text":"<p>Este ejemplo se base en el modelo de factura (<code>Invoice</code>), para generar un reporte HTML. </p> <pre><code>&lt;?php\n\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Report\\Resolver\\DefaultTemplateResolver;\nuse Greenter\\Report\\HtmlReport;\n\n$invoice = new Invoice();\n$invoice-&gt;setSerie('F001');\n$invoice-&gt;setCorrelativo('1');\n// ...\n\n$report = new HtmlReport();\n\n$resolver = new DefaultTemplateResolver();\n$report-&gt;setTemplate($resolver-&gt;getTemplate($invoice));\n\n$params = [\n    'system' =&gt; [\n        'logo' =&gt; file_get_contents('logo.png'), // Logo de Empresa\n        'hash' =&gt; 'qqnr2dN4p/HmaEA/CJuVGo7dv5g=', // Valor Resumen \n    ],\n    'user' =&gt; [\n        'header'     =&gt; 'Telf: &lt;b&gt;(01) 123375&lt;/b&gt;', // Texto que se ubica debajo de la direcci\u00f3n de empresa\n        'extras'     =&gt; [\n            // Leyendas adicionales\n            ['name' =&gt; 'CONDICION DE PAGO', 'value' =&gt; 'Efectivo'     ],\n            ['name' =&gt; 'VENDEDOR'         , 'value' =&gt; 'GITHUB SELLER'],\n        ],\n        'footer' =&gt; '&lt;p&gt;Nro Resolucion: &lt;b&gt;3232323&lt;/b&gt;&lt;/p&gt;'\n    ]\n];\n\n$html = $report-&gt;render($invoice, $params);\n\necho $html;\n</code></pre>"},{"location":"packages/report/#personalizar","title":"Personalizar","text":"<p>Puedes crear tus propios reportes usando twig, puedes tener como base invoice.html.twig.</p> <p>Necesitas crear un directorio con las nuevas plantillas, en este ejemplo el directorio se llama <code>custom</code>.</p> <pre><code>\u2502\n\u251c\u2500/custom/\n\u2502     \u251c\u2500 factura.html.twig\n\u2502     \u251c\u2500 nota-credito.html.twig\n\u2502\n\u2502\n</code></pre> <p>Configuraci\u00f3n de <code>HtmlReport</code>.</p> <pre><code>&lt;?php\n\nuse Greenter\\Report\\HtmlReport;\n\n$twigOptions = [\n    'cache' =&gt; __DIR__ . '/cache',\n    'strict_variables' =&gt; true,\n];\n\n$report = new HtmlReport('/custom', $twigOptions);\n$report-&gt;setTemplate('factura.html.twig');\n\n$html = $report-&gt;render($invoice, $params);\n\necho $html;\n</code></pre>"},{"location":"packages/report/#reporte-en-pdf","title":"Reporte en PDF","text":"<p>Para obtener una representaci\u00f3n en formato PDF, Utilizamos wkhtmltopdf.</p>"},{"location":"packages/report/#instalar_1","title":"Instalar","text":"<pre><code>composer require greenter/htmltopdf\n</code></pre> <p>Requerimientos</p> <p>Este paquete require que el ejecutable <code>wkhtmltopdf</code> este descargado o instalado en el host, y que el entorno de PHP permite ejecutar aplicaciones externas, es decir que el m\u00e9todo <code>exec</code> no se encuentre incluido en la configuraci\u00f3n <code>disable_functions</code> del <code>php.ini</code></p> <p>Puedes seguir este tutorial.</p>"},{"location":"packages/report/#uso_1","title":"Uso","text":"<p><code>PdfReport</code> sigue el patr\u00f3n Decorator, para generar el pdf a partir de <code>HtmlReport</code> o cualquier otra clase que implemente <code>ReportInterface</code>.</p> <pre><code>&lt;?php\n\nuse Greenter\\Report\\HtmlReport;\nuse Greenter\\Report\\PdfReport;\nuse Greenter\\Model\\Sale\\Invoice;\n\n$invoice = new Invoice();\n// ...\n\n$htmlReport = new HtmlReport();\n$html-&gt;setTemplate('invoice.html.twig');\n\n$report = new PdfReport($htmlReport);\n// Options: Ver mas en https://wkhtmltopdf.org/usage/wkhtmltopdf.txt\n$report-&gt;setOptions( [\n    'no-outline',\n    'viewport-size' =&gt; '1280x1024',\n    'page-width' =&gt; '21cm',\n    'page-height' =&gt; '29.7cm',\n]);\n$report-&gt;setBinPath('wkhtmltopdf.exe'); // Ruta relativa o absoluta de wkhtmltopdf\n// Los mismo parametros utilizados en HTML Report\n$params = [/*...*/];\n\n$pdf = $report-&gt;render($invoice, $params);\n\nif ($pdf === null) {\n    $error = $report-&gt;getExporter()-&gt;getError();\n    echo 'Error: '.$error;\n    return;\n}\n\nfile_put_contents('invoice.pdf', $pdf);\n</code></pre>"},{"location":"packages/report/#previsualizacion","title":"Previsualizaci\u00f3n","text":""},{"location":"packages/sign/","title":"Greener XMLDsig","text":"<p>Esta libreria permite realizar la firma digital de los documentos XML con un certificado electr\u00f3nico, siguiendo la normativa de SUNAT.</p>"},{"location":"packages/sign/#instalar","title":"Instalar","text":"<pre><code>composer require greenter/xmldsig\n</code></pre> <p>Requerimientos</p> <p>Se necesitar tener habilitado la extension <code>openssl</code> en <code>php.ini</code></p> <pre><code>extension=openssl\n</code></pre>"},{"location":"packages/sign/#uso","title":"Uso","text":"<p>Para este ejemplo necesitamos un archivo XML previamente generado, debemos asegurarnos de incluir la etiqueta <code>&lt;ext:ExtensionContent/&gt;</code>, que es donde se agregar\u00e1 el nodod de la firma.  </p> <p><pre><code>&lt;?php\n\nuse Greenter\\XMLSecLibs\\Sunat\\SignedXml;\n\n$xml = file_get_contents('20600995805-01-F001-1.xml');\n$cert = file_get_contents('certifcate.pem');\n\n$signer = new SignedXml();\n$signer-&gt;setCertificate($cert);\n\n$xmlSigned = $signer-&gt;signXml($xml);\n\nfile_put_contents(\"signed.xml\", $xmlSigned);\n</code></pre> El resultado seria:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Invoice xmlns=\"urn:oasis:names:specification:ubl:schema:xsd:Invoice-2\" xmlns:cac=\"urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2\" xmlns:cbc=\"urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ext=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\"&gt;\n&lt;ext:UBLExtensions&gt;\n&lt;ext:UBLExtension&gt;\n&lt;ext:ExtensionContent&gt;\n&lt;ds:Signature Id=\"SignIMM\"&gt;\n&lt;ds:SignedInfo&gt;\n&lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/&gt;\n&lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/&gt;\n&lt;ds:Reference URI=\"\"&gt;\n&lt;ds:Transforms&gt;\n&lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n&lt;/ds:Transforms&gt;\n&lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/&gt;\n&lt;ds:DigestValue&gt;IwJuNQGQaHmmm3iv2jj8JDv70Ow=&lt;/ds:DigestValue&gt;\n&lt;/ds:Reference&gt;\n&lt;/ds:SignedInfo&gt;\n&lt;ds:SignatureValue&gt;\nnLaghokzMNrmrfPnbIg9b...WluZTE1UiLFwZXXXPUlf2o=\n                &lt;/ds:SignatureValue&gt;\n&lt;ds:KeyInfo&gt;\n&lt;ds:X509Data&gt;\n&lt;ds:X509Certificate&gt;\nMIIFhzCCA3OgAwI...BgNVBAYTAlVTVQQIEwVNYWluZTEgMOiRJ00nE=\n                        &lt;/ds:X509Certificate&gt;\n&lt;/ds:X509Data&gt;\n&lt;/ds:KeyInfo&gt;\n&lt;/ds:Signature&gt;\n&lt;/ext:ExtensionContent&gt;\n&lt;/ext:UBLExtension&gt;\n&lt;/ext:UBLExtensions&gt;\n&lt;cbc:UBLVersionID&gt;2.1&lt;/cbc:UBLVersionID&gt;\n&lt;cbc:CustomizationID&gt;2.0&lt;/cbc:CustomizationID&gt;\n&lt;cbc:ID&gt;F001-1&lt;/cbc:ID&gt;\n&lt;!--....--&gt;\n&lt;/Invoice&gt;\n</code></pre> <p>Datos a considerar:   <code>&lt;ds:DigestValue&gt;</code>: Valor Resumen codificado en <code>base64</code>, utilizado en la representaci\u00f3n impresa y codigo QR.  <code>&lt;ds:SignatureValue&gt;</code>: Valor de la Firma codificado en <code>base64</code>.  <code>&lt;ds:X509Certificate&gt;</code>: Contenido del certificado, necesario para verificar la autenticidad del documento.   </p> <p>Otros formatos de certificado</p> <p>Puedes seguir esta gu\u00eda, para convertir un certificado al formato requerido.  </p>"},{"location":"packages/ws/","title":"Greenter WebServices","text":"<p>Esta libreria permite establecer la conexi\u00f3n con los servicios de SUNAT, para realizar la  comunicaci\u00f3n de los comprobantes electr\u00f3nicos emitidos. Internamente la libreria comprime los  comprobantes (archivos XML) antes de enviarlo a SUNAT bajo el protocolo <code>SOAP</code>, despues de recibir  el comprobante de recepci\u00f3n (CDR) extrae la respuesta para saber el estado del comprobante (Aprobado, Rechazado,  Observaciones). </p>"},{"location":"packages/ws/#instalar","title":"Instalar","text":"<pre><code>composer require greenter/ws\n</code></pre> <p>Requerimientos</p> <p>Se necesitar tener habilitado las extensiones <code>soap</code> en <code>php.ini</code></p> <pre><code>extension=soap\nextension=fileinfo\n</code></pre>"},{"location":"packages/ws/#uso","title":"Uso","text":"<p>Para este ejemplo necesitamos un documento XML firmado, y para autenticarnos en los servicios de SUNAT, la clave SOL, que para los servicios BETA son:</p> <ul> <li>User: <code>20000000001MODDATOS</code> (ruc + usuario SOL)</li> <li>Password: <code>moddatos</code></li> </ul> <pre><code>&lt;?php\nuse Greenter\\Ws\\Services\\SoapClient;\nuse Greenter\\Ws\\Services\\BillSender;\n\nrequire 'vendor/autoload.php';\n\n// URL del servicio para Facturas (BETA \u00f3 PRODUCCION).\n$urlService = 'https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService';\n$soap = new SoapClient();\n$soap-&gt;setService($urlService);\n$soap-&gt;setCredentials('20000000001MODDATOS', 'moddatos');\n$sender = new BillSender();\n$sender-&gt;setClient($soap);\n\n$xml = file_get_contents('factura.xml');\n$result = $sender-&gt;send('20000000001-01-F001-1', $xml);\n\nif (!$result-&gt;isSuccess()) {\n    // Error en la conexion con el servicio de SUNAT\n    var_dump($result-&gt;getError());\n    return;\n}\n\n$cdr = $result-&gt;getCdrResponse();\nfile_put_contents('R-20000000001-01-F001-1.zip', $result-&gt;getCdrZip());\n\n// Verificar CDR (Factura aceptada o rechazada)\n$code = (int)$cdr-&gt;getCode();\n\nif ($code === 0) {\n    echo 'ESTADO: ACEPTADA'.PHP_EOL;\n    if (count($cdr-&gt;getNotes()) &gt; 0) {\n        echo 'INCLUYE OBSERVACIONES:'.PHP_EOL;\n        // Mostrar observaciones\n        foreach ($cdr-&gt;getNotes() as $obs) {\n            echo 'OBS: '.$obs.PHP_EOL;\n        }\n    }\n\n} else if ($code &gt;= 2000 &amp;&amp; $code &lt;= 3999) {\n    echo 'ESTADO: RECHAZADA'.PHP_EOL;\n\n} else {\n    /* Esto no deber\u00eda darse, pero si ocurre, es un CDR inv\u00e1lido que deber\u00eda tratarse como un error-excepci\u00f3n. */\n    /*code: 0100 a 1999 */\n    echo 'Excepci\u00f3n';\n}\n\necho $cdr-&gt;getDescription().PHP_EOL;\n</code></pre> <p>Esta es una referencia de las clases a utilizar segun el tipo de comprobante.</p> <ul> <li><code>BillSender</code><ul> <li>Factura</li> <li>Boleta de Venta</li> <li>Notas de Cr\u00e9dito</li> <li>Notas de D\u00e9bito</li> <li>Comprobante de Percepci\u00f3n</li> <li>Comprobante de Retenci\u00f3n</li> </ul> </li> <li><code>SummarySender</code><ul> <li>Resumen Diario de Boletas</li> <li>Comunicaci\u00f3n de Baja</li> <li>Resumen de Reversiones (dar de baja C. de Percepci\u00f3n y Retenci\u00f3n)</li> </ul> </li> </ul>"},{"location":"packages/ws/#resumen-diario","title":"Resumen diario","text":"<p>El resumen diario tiene un proceso diferente al de las facturas, se tiene que realizar una  segunda petici\u00f3n al servicio, para obtener la respuesta de un resumen diario previamente enviado. En el envio inicial, SUNAT nos retorna un n\u00famero de Ticket que es el que usaremos para consultar el estado.  </p> <pre><code>&lt;?php\nuse Greenter\\Ws\\Services\\SoapClient;\nuse Greenter\\Ws\\Services\\SummarySender;\n\nrequire 'vendor/autoload.php';\n\n// URL del servicio, el mismo de Facturas.\n$urlService = 'https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService';\n$soap = new SoapClient();\n$soap-&gt;setService($urlService);\n$soap-&gt;setCredentials('20000000001MODDATOS', 'moddatos');\n$sender = new SummarySender();\n$sender-&gt;setClient($soap);\n\n$xml = file_get_contents('resumen.xml');\n$result = $sender-&gt;send('20000000001-RC-20200728-1', $xml);\n\nif (!$result-&gt;isSuccess()) {\n    // Error en la conexion con el servicio de SUNAT\n    var_dump($result-&gt;getError());\n    return;\n}\n\n// Guardar el ticket en el sistema, servira para consultar el estado del documento. \n$ticket = $result-&gt;getTicket();\n\necho $ticket;\n</code></pre> <p>Consultar el estado del documento enviado (Resumen diario, C. de Baja, R. Reversion). <pre><code>&lt;?php\n\nuse Greenter\\Ws\\Services\\SoapClient;\nuse Greenter\\Ws\\Services\\ExtService;\n\nrequire 'vendor/autoload.php';\n\n// N\u00famero de ticket obtenido en el paso anterior.\n$ticket = '1599432082640'; \n\n// URL del servicio.\n$urlService = 'https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService';\n$soap = new SoapClient();\n$soap-&gt;setService($urlService);\n$soap-&gt;setCredentials('20000000001MODDATOS', 'moddatos');\n$statusService = new ExtService();\n$statusService-&gt;setClient($soap);\n\n$status = $statusService-&gt;getStatus($ticket);\n\nif (!$status-&gt;isSuccess()) {\n    // Error en la conexion con el servicio de SUNAT\n    var_dump($status);\n    return;\n}\n\n$cdr = $status-&gt;getCdrResponse();\nfile_put_contents('R-20000000001-RC-20200728-1.zip', $status-&gt;getCdrZip());\nvar_dump($cdr);\n\n\n// Verificar CDR (Resumen aceptado o rechazado)\n$code = (int)$cdr-&gt;getCode();\n\nif ($code === 0) {\n    echo 'ESTADO: ACEPTADA'.PHP_EOL;\n    if (count($cdr-&gt;getNotes()) &gt; 0) {\n        echo 'INCLUYE OBSERVACIONES:'.PHP_EOL;\n        // Mostrar observaciones\n        foreach ($cdr-&gt;getNotes() as $obs) {\n            echo 'OBS: '.$obs.PHP_EOL;\n        }\n    }\n\n} else if ($code &gt;= 2000 &amp;&amp; $code &lt;= 3999) {\n    echo 'ESTADO: RECHAZADA'.PHP_EOL;\n\n} else {\n    /* Esto no deber\u00eda darse, pero si ocurre, es un CDR inv\u00e1lido que deber\u00eda tratarse como un error-excepci\u00f3n. */\n    /*code: 0100 a 1999 */\n    echo 'Excepci\u00f3n';\n}\n</code></pre></p> <p>Comunicaci\u00f3n de Baja</p> <p>La comunicaci\u00f3n de baja y resumen de reversi\u00f3n siguen el mismo proceso.</p>"},{"location":"packages/ws/#consulta-cdr","title":"Consulta CDR","text":"<p>Si por alg\u00fan motivo no disponemos del <code>CDR</code>, lo podemos volver a obtener consultando al servicio de SUNAT, pero tener en cuenta que solo es posible en Producci\u00f3n y solo esta disponible para Facturas y Notas de Cr\u00e9dito/D\u00e9bito relacionada a facturas.</p> <pre><code>&lt;?php\n\nuse Greenter\\Ws\\Services\\ConsultCdrService;\nuse Greenter\\Ws\\Services\\SoapClient;\n\nrequire 'vendor/autoload.php';\n\n// URL CDR de Producci\u00f3n\n$wsdlUrl = 'https://e-factura.sunat.gob.pe/ol-it-wsconscpegem/billConsultService?wsdl';\n$soap = new SoapClient($wsdlUrl);\n$soap-&gt;setCredentials('20000000001MODDATOS', 'moddatos');\n\n$service = new ConsultCdrService();\n$service-&gt;setClient($soap);\n\n$rucEmisor = '20000000001';\n$tipoDocumento = '01'; // 01: Factura, 07: Nota de Cr\u00e9dito, 08: Nota de D\u00e9bito\n$serie = 'F001';\n$correlativo = '1';\n$result = $service-&gt;getStatusCdr($rucEmisor, $tipoDocumento, $serie, $correlativo);\n\nif (!$result-&gt;isSuccess()) {\n    var_dump($result-&gt;getError());\n    return;\n}\n\n$cdr = $result-&gt;getCdrResponse();\nif ($cdr === null) {\n    echo 'CDR no encontrado, el comprobante no ha sido comunicado a SUNAT.';\n    return;\n}\n\nfile_put_contents('R-20000000001-01-F001-1.zip', $result-&gt;getCdrZip());\nvar_dump($cdr);\n</code></pre>"},{"location":"packages/ws/#servicios","title":"Servicios","text":"<p>SUNAT dispone de servicios de prueba (<code>BETA</code>) y de producci\u00f3n para los diferentes tipos de  comprobantes electr\u00f3nicos.</p> BETA Servicio Ruta Factura https://e-beta.sunat.gob.pe/ol-ti-itcpfegem-beta/billService?wsdl Guia https://e-beta.sunat.gob.pe/ol-ti-itemision-guia-gem-beta/billService?wsdl Retenci\u00f3n y Percepci\u00f3n https://e-beta.sunat.gob.pe/ol-ti-itemision-otroscpe-gem-beta/billService?wsdl Producci\u00f3n Servicio Ruta Factura https://e-factura.sunat.gob.pe/ol-ti-itcpfegem/billService?wsdl Guia https://e-guiaremision.sunat.gob.pe/ol-ti-itemision-guia-gem/billService?wsdl Retenci\u00f3n y Percepci\u00f3n https://e-factura.sunat.gob.pe/ol-ti-itemision-otroscpe-gem/billService?wsdl Consulta CDR https://e-factura.sunat.gob.pe/ol-it-wsconscpegem/billConsultService?wsdl"},{"location":"packages/xml-parser/","title":"Grenter XML Parser","text":"<p>Esta libreria permite crear objetos PHP a partir de documentos XML.</p> <p>UBL 2.1</p> <p>Actualmente solo esta implementada la versi\u00f3n <code>UBL 2.0</code>, a\u00fan esta pendiente la implementaci\u00f3n de la versi\u00f3n <code>UBL 2.1</code>.</p>"},{"location":"packages/xml-parser/#instalar","title":"Instalar","text":"<pre><code>composer require greenter/xml-parser\n</code></pre>"},{"location":"packages/xml-parser/#documentos","title":"Documentos","text":"<p>Los documentos disponibles en este paquete son:</p> Documento UBL Parser Comprobante Invoice <code>InvoiceParser</code> Factura, Boleta de venta CreditNote <code>NoteParser</code> Nota de Cr\u00e9dito DebitNote <code>NoteParser</code> Nota de D\u00e9bito Summary <code>SummaryParser</code> Resumen diario Voided <code>VoidedParser</code> Comunicaci\u00f3n de Baja, Reversion Despatch <code>DespatchParser</code> Gu\u00eda de Remisi\u00f3n Retention <code>RetentionParser</code> Retenci\u00f3n Perception <code>PerceptionParser</code> Percepci\u00f3n"},{"location":"packages/xml-parser/#uso","title":"Uso","text":"<p>Los archivo XML ser\u00e1n convertidos a modelos de documentos disponibles en greenter/core, los cuales implementan <code>DocumentInterface</code>.</p> <pre><code>&lt;?php\n\nuse Greenter\\Xml\\Parser\\InvoiceParser;\nuse Greenter\\Xml\\Parser\\PerceptionParser;\nrequire 'vendor/autoload.php';\n\n$parser = new InvoiceParser();\n$xml = file_get_contents('20000000001-01-F001-1.xml');\n$factura = $parser-&gt;parse($xml);\n\nvar_dump($factura);\n\n$parser = new InvoiceParser();\n$xml = file_get_contents('20000000001-03-B001-1.xml');\n$boleta = $parser-&gt;parse($xml);\n\nvar_dump($boleta);\n\n$parser = new PerceptionParser();\n$xml = file_get_contents('20000000001-40-P001-1.xml');\n$percepcion = $parser-&gt;parse($xml);\n\nvar_dump($percepcion);\n</code></pre> <p>Tambi\u00e9n puedes crear tu propia versi\u00f3n, implementando <code>DocumentParserInterface</code>.</p> <pre><code>&lt;?php\n\nnamespace Greenter\\Parser;\n\ninterface DocumentParserInterface\n{\n    /**\n     * @param \\DomDocument|string $value\n     *\n     * @return DocumentInterface\n     */\n    public function parse($value): DocumentInterface;\n}\n</code></pre>"},{"location":"packages/xml/","title":"Grenter XML","text":"<p>Esta libreria permite generar documentos XML siguiendo el est\u00e1ndar UBL 2.0 y 2.1, ademas de considerar las normas establecidas por SUNAT.</p> <p>UBL 2.0</p> <p>No usar la versi\u00f3n 2.0 para generar Facturas, Boletas, Notas de Cr\u00e9dito, Notas de D\u00e9bito, ya que SUNAT actualmente exige utilizar la versi\u00f3n <code>UBL 2.1</code>.</p>"},{"location":"packages/xml/#instalar","title":"Instalar","text":"<pre><code>composer require greenter/xml\n</code></pre>"},{"location":"packages/xml/#documentos","title":"Documentos","text":"<p>Los documentos disponibles en este paquete son:</p> Documento UBL Builder Comprobante Invoice <code>InvoiceBuilder</code> Factura, Boleta de Venta CreditNote <code>NoteBuilder</code> Nota de Cr\u00e9dito DebitNote <code>NoteBuilder</code> Nota de D\u00e9bito Summary <code>SummaryBuilder</code> Resumen diario Voided <code>VoidedBuilder</code> Comunicaci\u00f3n de Baja, Reversion Despatch <code>DespatchBuilder</code> Gu\u00eda de Remisi\u00f3n Retention <code>RetentionBuilder</code> Retenci\u00f3n Perception <code>PerceptionBuilder</code> Percepci\u00f3n"},{"location":"packages/xml/#uso","title":"Uso","text":"<p>Para generar el archivo XML nos basamos en modelos de documentos disponibles en greenter/core, los cuales implementan <code>DocumentInterface</code>.</p> <p>Para una factura el modelo a utilizar es <code>Invoice</code>, y para generar el XML debemos usar <code>InvoiceBuilder</code>.</p> <pre><code>&lt;?php\n\nuse Greenter\\Model\\Sale\\Invoice;\nuse Greenter\\Xml\\Builder\\InvoiceBuilder;\n\n$invoice = new Invoice();\n$invoice-&gt;setSerie('F001');\n$invoice-&gt;setCorrelativo('1');\n// ...\n\n$builder = new InvoiceBuilder();\n$xml = $builder-&gt;build($invoice);\n\necho $xml;\n</code></pre> <p>Tener en cuenta que esto solo crea el XML pero no realiza la firma, para ello utilizar <code>greenter/xmldsig</code>.   El siguiente fragmento es una previsualizaci\u00f3n del resultado:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Invoice xmlns=\"urn:oasis:names:specification:ubl:schema:xsd:Invoice-2\" xmlns:cac=\"urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2\" xmlns:cbc=\"urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ext=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\"&gt;\n&lt;ext:UBLExtensions&gt;\n&lt;ext:UBLExtension&gt;\n&lt;ext:ExtensionContent&gt;\n&lt;/ext:ExtensionContent&gt;\n&lt;/ext:UBLExtension&gt;\n&lt;/ext:UBLExtensions&gt;\n&lt;cbc:UBLVersionID&gt;2.1&lt;/cbc:UBLVersionID&gt;\n&lt;cbc:CustomizationID&gt;2.0&lt;/cbc:CustomizationID&gt;\n&lt;cbc:ID&gt;F001-1&lt;/cbc:ID&gt;\n&lt;!--....--&gt;\n&lt;/Invoice&gt;\n</code></pre>"},{"location":"packages/xml/#avanzado","title":"Avanzado","text":"<p>Esta libreria para generar los XML emplea el motor de plantillas twig, si necesitas cambiar algunos parametros puedes hacerlo desde el constructor.</p> <p>Ejemplo</p> <pre><code>&lt;?php\n\nuse Greenter\\Xml\\Builder\\InvoiceBuilder;\n\n$options = [\n    'cache' =&gt; '/tmp/compilation_cache'\n];\n\n$builder = new InvoiceBuilder($options);\n</code></pre> <p>Tambi\u00e9n puedes crear tu propia versi\u00f3n, implementando <code>BuilderInterface</code>.</p>"}]}